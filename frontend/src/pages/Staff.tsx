import React, { useState, useEffect } from 'react';
import {
  Box,
  Typography,
  Button,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  TextField,
  FormControl,
  InputLabel,
  Select,
  MenuItem,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  IconButton,
  Alert,
  Chip,
  Grid,
  CircularProgress,
  Tooltip
} from '@mui/material';\nimport {\n  Add,\n  Edit,\n  Delete,\n  Person,\n  Email,\n  Badge\n} from '@mui/icons-material';\nimport { authAPI, User, StaffRequest } from '../services/api';\n\nconst Staff: React.FC = () => {\n  const [staff, setStaff] = useState<User[]>([]);\n  const [openDialog, setOpenDialog] = useState(false);\n  const [editingStaff, setEditingStaff] = useState<User | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState<StaffRequest>({\n    username: '',\n    password: '',\n    email: '',\n    firstName: '',\n    lastName: '',\n    role: 'ROLE_RECEPTIONIST'\n  });\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n\n  useEffect(() => {\n    fetchStaff();\n  }, []);\n\n  const fetchStaff = async () => {\n    setLoading(true);\n    try {\n      const data = await authAPI.getAllStaff();\n      setStaff(data);\n    } catch (err) {\n      setError('Failed to fetch staff');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleOpenDialog = (staffMember?: User) => {\n    if (staffMember) {\n      setEditingStaff(staffMember);\n      setFormData({\n        username: staffMember.username,\n        email: staffMember.email,\n        firstName: staffMember.firstName,\n        lastName: staffMember.lastName,\n        role: staffMember.role\n      });\n    } else {\n      setEditingStaff(null);\n      setFormData({\n        username: '',\n        password: '',\n        email: '',\n        firstName: '',\n        lastName: '',\n        role: 'ROLE_RECEPTIONIST'\n      });\n    }\n    setOpenDialog(true);\n    setError('');\n  };\n\n  const handleCloseDialog = () => {\n    setOpenDialog(false);\n    setEditingStaff(null);\n    setError('');\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.username || !formData.email || !formData.firstName || !formData.lastName) {\n      setError('All fields are required');\n      return;\n    }\n\n    if (!editingStaff && !formData.password) {\n      setError('Password is required for new staff');\n      return;\n    }\n\n    try {\n      if (editingStaff) {\n        await authAPI.updateStaff(editingStaff.id, formData);\n        setSuccess('Staff updated successfully');\n      } else {\n        await authAPI.createStaff(formData);\n        setSuccess('Staff created successfully');\n      }\n      fetchStaff();\n      handleCloseDialog();\n    } catch (err: any) {\n      setError(err.response?.data?.message || 'Operation failed');\n    }\n  };\n\n  const handleDelete = async (id: number, name: string) => {\n    if (window.confirm(`Are you sure you want to delete ${name}?`)) {\n      try {\n        await authAPI.deleteStaff(id);\n        setSuccess('Staff deleted successfully');\n        fetchStaff();\n      } catch (err: any) {\n        setError(err.response?.data?.message || 'Delete failed');\n      }\n    }\n  };\n\n  const getRoleColor = (role: string) => {\n    switch (role) {\n      case 'ROLE_MANAGER':\n        return 'error';\n      case 'ROLE_RECEPTIONIST':\n        return 'primary';\n      default:\n        return 'default';\n    }\n  };\n\n  const getRoleLabel = (role: string) => role.replace('ROLE_', '');\n\n  return (\n    <Box sx={{ p: 3 }}>\n      <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={3}>\n        <Box>\n          <Typography variant=\"h4\" fontWeight=\"bold\">Staff Management</Typography>\n          <Typography variant=\"body2\" color=\"textSecondary\" sx={{ mt: 0.5 }}>\n            Manage hotel staff members and their roles\n          </Typography>\n        </Box>\n        <Button\n          variant=\"contained\"\n          startIcon={<Add />}\n          onClick={() => handleOpenDialog()}\n          size=\"large\"\n          sx={{ textTransform: 'none', fontWeight: 600 }}\n        >\n          Add Staff Member\n        </Button>\n      </Box>\n\n      {error && <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError('')}>{error}</Alert>}\n      {success && <Alert severity=\"success\" sx={{ mb: 2 }} onClose={() => setSuccess('')}>{success}</Alert>}\n\n      {loading ? (\n        <Box display=\"flex\" justifyContent=\"center\" py={5}>\n          <CircularProgress />\n        </Box>\n      ) : (\n        <TableContainer component={Paper} sx={{ boxShadow: 2 }}>\n          <Table>\n            <TableHead sx={{ backgroundColor: '#f5f5f5' }}>\n              <TableRow>\n                <TableCell sx={{ fontWeight: 'bold' }}>Name</TableCell>\n                <TableCell sx={{ fontWeight: 'bold' }}>Username</TableCell>\n                <TableCell sx={{ fontWeight: 'bold' }}>Email</TableCell>\n                <TableCell sx={{ fontWeight: 'bold' }}>Role</TableCell>\n                <TableCell sx={{ fontWeight: 'bold', textAlign: 'center' }}>Actions</TableCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {staff.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={5} align=\"center\" sx={{ py: 4 }}>\n                    <Typography color=\"textSecondary\">No staff members found</Typography>\n                  </TableCell>\n                </TableRow>\n              ) : (\n                staff.map((member) => (\n                  <TableRow key={member.id} hover>\n                    <TableCell>\n                      <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                        <Person fontSize=\"small\" color=\"primary\" />\n                        <Typography fontWeight={500}>\n                          {member.firstName} {member.lastName}\n                        </Typography>\n                      </Box>\n                    </TableCell>\n                    <TableCell>\n                      <Chip label={member.username} variant=\"outlined\" size=\"small\" />\n                    </TableCell>\n                    <TableCell>\n                      <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                        <Email fontSize=\"small\" sx={{ color: '#999' }} />\n                        <Typography variant=\"body2\">{member.email}</Typography>\n                      </Box>\n                    </TableCell>\n                    <TableCell>\n                      <Chip\n                        label={getRoleLabel(member.role)}\n                        color={getRoleColor(member.role) as any}\n                        size=\"small\"\n                        icon={<Badge />}\n                      />\n                    </TableCell>\n                    <TableCell align=\"center\">\n                      <Tooltip title=\"Edit\">\n                        <IconButton\n                          color=\"primary\"\n                          onClick={() => handleOpenDialog(member)}\n                          size=\"small\"\n                        >\n                          <Edit />\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip title=\"Delete\">\n                        <IconButton\n                          color=\"error\"\n                          onClick={() => handleDelete(member.id, `${member.firstName} ${member.lastName}`)}\n                          size=\"small\"\n                        >\n                          <Delete />\n                        </IconButton>\n                      </Tooltip>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </TableContainer>\n      )}\n\n      <Dialog open={openDialog} onClose={handleCloseDialog} maxWidth=\"sm\" fullWidth>\n        <DialogTitle sx={{ fontWeight: 'bold', fontSize: '1.3rem' }}>\n          {editingStaff ? 'Edit Staff Member' : 'Add New Staff Member'}\n        </DialogTitle>\n        <DialogContent>\n          <Box sx={{ pt: 2 }}>\n            <Grid container spacing={2}>\n              <Grid item xs={12} md={6}>\n                <TextField\n                  fullWidth\n                  label=\"First Name\"\n                  value={formData.firstName}\n                  onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                  required\n                  variant=\"outlined\"\n                />\n              </Grid>\n              <Grid item xs={12} md={6}>\n                <TextField\n                  fullWidth\n                  label=\"Last Name\"\n                  value={formData.lastName}\n                  onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                  required\n                  variant=\"outlined\"\n                />\n              </Grid>\n              <Grid item xs={12}>\n                <TextField\n                  fullWidth\n                  label=\"Username\"\n                  value={formData.username}\n                  onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                  required\n                  variant=\"outlined\"\n                />\n              </Grid>\n              <Grid item xs={12}>\n                <TextField\n                  fullWidth\n                  label=\"Email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  required\n                  variant=\"outlined\"\n                />\n              </Grid>\n              {!editingStaff && (\n                <Grid item xs={12}>\n                  <TextField\n                    fullWidth\n                    label=\"Password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                    required\n                    variant=\"outlined\"\n                    helperText=\"Minimum 6 characters\"\n                    inputProps={{ minLength: 6 }}\n                  />\n                </Grid>\n              )}\n              <Grid item xs={12}>\n                <FormControl fullWidth required>\n                  <InputLabel>Role</InputLabel>\n                  <Select\n                    value={formData.role}\n                    onChange={(e) => setFormData({ ...formData, role: e.target.value as any })}\n                    label=\"Role\"\n                  >\n                    <MenuItem value=\"ROLE_RECEPTIONIST\">Receptionist</MenuItem>\n                    <MenuItem value=\"ROLE_MANAGER\">Manager</MenuItem>\n                  </Select>\n                </FormControl>\n              </Grid>\n            </Grid>\n          </Box>\n        </DialogContent>\n        <DialogActions sx={{ p: 2 }}>\n          <Button onClick={handleCloseDialog}>Cancel</Button>\n          <Button onClick={handleSubmit} variant=\"contained\" sx={{ textTransform: 'none', fontWeight: 600 }}>\n            {editingStaff ? 'Update' : 'Create'}\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default Staff;
